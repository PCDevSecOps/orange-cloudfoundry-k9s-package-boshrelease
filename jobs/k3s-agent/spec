---
name: k3s-agent

packages:
- k3s
- kubectl-k3s
- k3s-images
templates:
  config/bpm.yml: config/bpm.yml
  bin/pre-start.erb: bin/pre-start
  bin/post-start.erb: bin/post-start  
  bin/pre-stop.erb: bin/pre-stop
  bin/post-stop.erb: bin/post-stop
  bin/post-deploy.erb: bin/post-deploy
  bin/drain.erb: bin/drain
  bin/ctl.erb: bin/ctl
  bin/k3s-killall.sh: bin/k3s-killall.sh



  config/registries.yaml.erb: config/registries.yaml
  config/registry.ca.erb: config/registry.ca
  config/registry.cert.erb: config/registry.cert
  config/registry.key.erb: config/registry.key 


# Documentation https://bosh.io/docs/links.html
# Tutorial      https://gist.github.com/Amit-PivotalLabs/c39528248b8cdc4ba8e347f8aa68abb6
consumes:
- name: k3s-server
  type: k3s-server
  optional: false


provides:
- name: k3s-agent
  type: k3s-agent

properties:

  registry.mirrors.endpoint:
    description: private registry endpoint, eg http://localhost:5000

  registry.mirrors.auth.username:
    description: private registry user

  registry.mirrors.auth.password:
    description: private registry password

  registry.mirrors.tls.cert:
    description: private registry certificate

  registry.mirrors.tls.key:
    description: private registry private key

  registry.mirrors.tls.ca:
    description: private registry ca


  k3s.v:
    description: "(logging) Number for the log level verbosity (default: 0)"
    default: 0
  k3s.bind-address value:
    description: "(listener) k3s bind address (default: 0.0.0.0)"
    default: 0.0.0.0
  k3s.flannel-backend:
    description: (networking) One of 'none', 'vxlan', 'ipsec', or 'wireguard'
    default: vxlan
  k3s.token:
    description: (cluster) Shared secret used to join a server or agent to a cluster [$K3S_TOKEN]
  k3s.node-label:
    description: (agent/node) Registering and starting kubelet with set of labels
    default: ""
  k3s.node-taint: 
    description: (agent/node) Registering kubelet with set of taints
    default: ""
